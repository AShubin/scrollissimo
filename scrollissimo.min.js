/**
 * Scrollissimo
 * Javascript plugin for scroll animation
 * @author frux
 */
(function(e){function p(a,b,c,f){var d=Math.min(c,f),e=Math.max(c,f);if(d<=a&&e>=a)b=Math.min(e,b);else if(e>=b&&d<=b)a=Math.max(d,a),b=Math.min(e,b);else if(d>=a&&e<=b)b=a=d;else return;return c<f?{from:a,to:b}:{from:b,to:a}}function h(a,b){b=b||g;if("string"===typeof a)return"%"===a.substr(-1,1)?parseInt(a)/100:"px"===a.substr(-2,2)?parseInt(a)/b:parseInt(a)/d._getDocHeight();if(!isNaN(a))return a/b}function t(a,b){if("object"===typeof a){var c={};c.property=a.property;c.from=a.from||0;c.to=a.to|| 0;c.prefix=a.prefix||"";c.suffix=a.suffix||"";c.duration=h(a.duration)||0;c.target=a.target.jquery?1<a.target.length?a.target.get():a.target.get(0):a.target;"undefined"===typeof(c.start=h(a.start))&&(c.start=b.end);c.queue=b;return{animator:null,target:a.target,sourceParams:a,params:c,render:u.bind(this,c.start,c.duration,(a.func||function(a){this.length?this.forEach(function(b){k(b,c.property,c.prefix+(c.from+(c.to-c.from)*a)+c.suffix)}):k(this,c.property,c.prefix+(c.from+(c.to-c.from)*a)+c.suffix)}).bind(c.target)), recalc:function(a){a=a||d._getDocHeight();this.params.duration=h(this.sourceParams.duration||"",a);"undefined"===typeof this.sourceParams.start&&(this.params.start=h(this.sourceParams.start,a))},getIntersection:function(a,b){return p(this.params.start,this.params.start+this.params.duration,a,b)}}}}function u(a,b,c,d){a=(d-a)/b;0<a&&1>a?c(a):1<=a?c(1):0>=a&&c(0)}var d={},q=0,l=d._getWinHeight,m=[],n=[],g,r,k;(function(){var a=0,b=["ms","moz","webkit","o"],c=b.length,f,g=!(!e.performance||!e.performance.now); if(e.requestAnimationFrame)d._requestAnimationFrame=e.requestAnimationFrame.bind(e);else{for(f=0;f<c&&!e.requestAnimationFrame;f+=1)console.log(f,c),d._requestAnimationFrame=e[b[f]+"RequestAnimationFrame"].bind(e);d._requestAnimationFrame||(d._requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),f=e.setTimeout(function(){b(c+d)},d);a=c+d;return f}.bind(e))}if(!g){var h=d._requestAnimationFrame,k=+new Date;d._requestAnimationFrame=function(a,b){h(function(b){return a(1E12> b?b:b-k)},b)}}})();d._on=function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c)};d._getDocHeight=function(){var a=document.documentElement,b=document.body;return Math.max(b.scrollHeight,a.scrollHeight,b.offsetHeight,a.offsetHeight,b.clientHeight,a.clientHeight)};d._getWinHeight=function(){return Number(e.innerHeight)||Number(e.clientHeight)};g=d._getDocHeight();l=d._getWinHeight();r="pageYOffset"in window?function(){return(window.pageYOffset||0)-(document.clientTop|| 0)}:function(){return(document.scrollTop||0)-(document.clientTop||0)};k=e.jQuery?function(a,b,c){$(a).css(b,c)}:function(a,b,c){a.style.setProperty(b,c)};(function(a){a.Queue=function(b){this.end=this.start=0;!isNaN(b)&&(this.smoother=new a.Queue.Smoother(this,b))};a.Queue.prototype=Array.prototype.slice.call(Array.prototype);a.Queue.prototype.add=function(a){if(!(a instanceof Array))if("object"===typeof a)a=[a];else return;a.forEach(function(a){if(a=t(a,this))this.push(a),this.end<a.params.start+ a.params.duration&&(this.end=a.params.start+a.params.duration)}.bind(this));this.sort(function(a,b){return a.params.duration-b.params.duration});this.start=this[0]&&this[0].params.start||0;return this};a.Queue.prototype.getIntersection=function(a,c){return p(this.start,this.end,a,c)};a.Queue.Smoother=function(a,c){this.status="idle";this.animateTo=this.animateFrom=0;this.maxSpeed=+c;this.queue=a};a.Queue.Smoother.prototype.render=function(a,c){this.queue.forEach(function(d){var e=d.getIntersection(a, c);e&&d.render(e.to)})};a.Queue.Smoother.prototype.step=function(){var b=this.animateTo-this.animateFrom;Math.abs(b)>this.maxSpeed?(this.render(this.animateFrom,this.animateFrom+=this.maxSpeed*(0<b?1:-1)),a._requestAnimationFrame(this.step.bind(this))):(this.render(this.animateFrom,this.animateTo),this.status="idle",this.animateFrom=this.animateTo)};a.Queue.Smoother.prototype.smooth=function(b,c){var d=this.queue.getIntersection(b,c);if(d)return this.animateTo=d.to,"idle"===this.status&&(this.status= "busy",a._requestAnimationFrame(this.step.bind(this))),this.id=a._requestAnimationFrame(this.step.bind(this)),this}})(d);d._render=function(a){n.forEach(function(b){b.forEach(function(b){b.render(a)})});m.forEach(function(b){b.smoother.smooth(d.lastProgress,a)});d.lastProgress=a}.bind(d);d.lastProgress=0;d._catch=function(){var a=r(),b=a/(g-l);a!==q&&this._render(b);q=a};d.add=function(a,b){var c;a=a||[];c=(new this.Queue(b)).add(a);(b?m:n).push(c);return c}.bind(d);d.knock=function(){this._catch(); setTimeout(this._catch.bind(this),100)};d._on(window,"resize",function(){l=d._getWinHeight();g=d._getDocHeight();n.forEach(function(a){a.forEach(function(a){a.recalc(g)})});m.forEach(function(a){a.forEach(function(a){a.recalc(g)})})});d.isTouchMode="ontouchstart"in document.body;e.Scrollissimo=d})(this);
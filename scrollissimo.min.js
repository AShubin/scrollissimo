/**
 * Scrollissimo
 * Javascript plugin for scroll animation
 * @author frux
 */
(function(e){for(var k=0,g=["ms","moz","webkit","o"],f=0;f<g.length&&!e.requestAnimationFrame;++f)e.requestAnimationFrame=e[g[f]+"RequestAnimationFrame"],e.cancelAnimationFrame=e[g[f]+"CancelAnimationFrame"]||e[g[f]+"CancelRequestAnimationFrame"];e.requestAnimationFrame||(e.requestAnimationFrame=function(g){var f=(new Date).getTime(),h=Math.max(0,16-(f-k)),d=e.setTimeout(function(){g(f+h)},h);k=f+h;return d});e.cancelAnimationFrame||(e.cancelAnimationFrame=function(e){clearTimeout(e)})})(this); function Scrollissimo(e){function k(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,a[b+c])}function g(){var a=document.documentElement,b=document.body;return Math.max(b.scrollHeight,a.scrollHeight,b.offsetHeight,a.offsetHeight,b.clientHeight,a.clientHeight)}function f(a,b,c,d){var e=Math.min(c,d),f=Math.max(c,d);if(e<=a&&f>=a)b=Math.min(f,b);else if(f>=b&&e<=b)a=Math.max(e,a),b=Math.min(f,b);else if(e>=a&&f<=b)b=a=e;else return;return c<d?{from:a,to:b}:{from:b,to:a}}function m(a, b){b=b||l;if("string"===typeof a)return"%"===a.substr(-1,1)?parseInt(a)/100:"px"===a.substr(-2,2)?parseInt(a)/b:parseInt(a)/g();if(!isNaN(a))return a/b}function v(a,b){if("object"===typeof a){var c={};c.property=a.property;c.from=a.from||0;c.to=a.to||0;c.prefix=a.prefix||"";c.suffix=a.suffix||"";c.duration=m(a.duration)||0;"undefined"===typeof(c.start=m(a.start))&&(c.start=b.end);c.queue=b;return{animator:null,sourceParams:a,params:c,render:function(b){b=(b-this.params.start)/this.params.duration; 0<b&&1>b?n(a.target,this.params.property,this.params.prefix+(this.params.from+(this.params.to-this.params.from)*b)+this.params.suffix):1<=b?n(a.target,this.params.property,this.params.prefix+this.params.to+this.params.suffix):0>=b&&n(a.target,this.params.property,this.params.prefix+this.params.from+this.params.suffix)},recalc:function(a){a=a||g();this.params.duration=m(this.sourceParams.duration||"",a);"undefined"===typeof this.sourceParams.start&&(this.params.start=m(this.sourceParams.start,a))}, getIntersection:function(a,b){return f(this.params.start,this.params.start+this.params.duration,a,b)}}}}function h(){var a=r(),b=a/(l-t);a!==u&&this.render(b);u=a}var d={},u=0,l=g()||0,t=Number(window.innerHeight)||window.innerHeight,p=[],q=[],r,n;r="pageYOffset"in window?function(){return(window.pageYOffset||0)-(document.clientTop||0)}:function(){return(document.scrollTop||0)-(document.clientTop||0)};n=window.jQuery?function(a,b,c){$(a).css(b,c)}:function(a,b,c){a.style.setProperty(b,c)};d.Queue= function(a){this.end=this.start=0;!isNaN(a)&&(this.smoother=new d.Queue.Smoother(this,a))};d.Queue.prototype=Array.prototype.slice.call(Array.prototype);d.Queue.prototype.add=function(a){if(!(a instanceof Array))if("object"===typeof a)a=[a];else return;a.forEach(function(a){if(a=v(a,this))this.push(a),this.end<a.params.start+a.params.duration&&(this.end=a.params.start+a.params.duration)}.bind(this));this.sort(function(a,c){return a.params.duration-c.params.duration});this.start=this[0]&&this[0].params.start|| 0;return this};d.Queue.prototype.getIntersection=function(a,b){return f(this.start,this.end,a,b)};d.Queue.Smoother=function(a,b){this.status="idle";this.animateTo=this.animateFrom=0;this.maxSpeed=+b;this.queue=a};d.Queue.Smoother.prototype.render=function(a,b){this.queue.forEach(function(c){var d=c.getIntersection(a,b);d&&c.render(d.to)})};d.Queue.Smoother.prototype.step=function(){var a=this.animateTo-this.animateFrom;Math.abs(a)>this.maxSpeed?(this.render(this.animateFrom,this.animateFrom+=this.maxSpeed* (0<a?1:-1)),requestAnimationFrame(this.step.bind(this))):(this.render(this.animateFrom,this.animateTo),this.status="idle",this.animateFrom=this.animateTo)};d.Queue.Smoother.prototype.smooth=function(a,b){var c=this.queue.getIntersection(a,b);if(c)return this.animateTo=c.to,"idle"===this.status&&(this.status="busy",requestAnimationFrame(this.step.bind(this))),this.id=requestAnimationFrame(this.step.bind(this)),this;d.Smoother.smooth=function(a){var b=this;p.forEach(function(c){c.forEach(function(c){var d= c.getIntersection.call(c,lastProgress,a);d&&d.from!==d.to&&(!c.animator&&(c.animator=new b.Animator(c))||"playing"!==c.animator.status?(c.animator.animateTo=d.to,c.animator.run()):c.animator.animateTo=d.to)})});lastProgress=a}.bind(d.Smoother)};d.add=function(a,b){var c;a=a||[];c=(new this.Queue(b)).add(a);(b?p:q).push(c);return c}.bind(d);d.render=function(a){q.forEach(function(b){b.forEach(function(b){b.render(a)})});p.forEach(function(b){b.smoother.smooth(d.lastProgress,a)});d.lastProgress=a}.bind(d); d.lastProgress=0;k(window,"resize",function(){t=Number(window.innerHeight)||window.innerHeight;l=g();q.forEach(function(a){a.forEach(function(a){a.recalc(l);console.log(a)})});p.forEach(function(a){a.forEach(function(a){a.recalc(l);console.log(a)})})});k(window,"scroll",function(){h.call(d);setTimeout(function(){h.call(d)},100)});(e||function(){}).call(d);return d};
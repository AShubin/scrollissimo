/**
 * Scrollissimo
 * Javascript plugin for scroll animation
 * @author frux
 */
(function(d){for(var l=0,g=["ms","moz","webkit","o"],e=0;e<g.length&&!d.requestAnimationFrame;++e)d.requestAnimationFrame=d[g[e]+"RequestAnimationFrame"],d.cancelAnimationFrame=d[g[e]+"CancelAnimationFrame"]||d[g[e]+"CancelRequestAnimationFrame"];d.requestAnimationFrame||(d.requestAnimationFrame=function(e,g){var c=(new Date).getTime(),k=Math.max(0,16-(c-l)),h=d.setTimeout(function(){e(c+k)},k);l=c+k;return h});d.cancelAnimationFrame||(d.cancelAnimationFrame=function(d){clearTimeout(d)})})(this); function Scrollissimo(d){function l(b,a,f){b.addEventListener?b.addEventListener(a,f,!1):b.attachEvent("on"+a,b[a+f])}function g(){var b=document.documentElement,a=document.body;return Math.max(a.scrollHeight,b.scrollHeight,a.offsetHeight,b.offsetHeight,a.clientHeight,b.clientHeight)}function e(b,a){a=a||h;if("string"===typeof b)return"%"===b.substr(-1,1)?parseInt(b)/100:"px"===b.substr(-2,2)?parseInt(b)/a:parseInt(b)/g();if(!isNaN(b))return b/a}function u(b,a,f){if("object"===typeof a){var c={}; c.property=a.property;c.from=a.from||0;c.to=a.to||0;c.prefix=a.prefix||"";c.suffix=a.suffix||"";c.duration=e(a.duration)||0;c.maxSpeed=parseFloat(a.maxSpeed);"undefined"===typeof(c.start=e(a.start))&&(c.start=f.endTime,f.endTime+=c.duration);c.queue=f;return{animator:null,sourceParams:a,params:c,render:function(a){a=(a-this.params.start)/this.params.duration;0<a&&1>a?m(b,this.params.property,this.params.prefix+(this.params.from+(this.params.to-this.params.from)*a)+this.params.suffix):1<=a?m(b,this.params.property, this.params.prefix+this.params.to+this.params.suffix):0>=a&&m(b,this.params.property,this.params.prefix+this.params.from+this.params.suffix)},recalc:function(a){a=a||g();this.params.duration=e(this.sourceParams.duration||"",a);"undefined"===typeof this.sourceParams.start&&(this.params.start=e(this.sourceParams.start,a))},getIntersection:function(a,b){var f=Math.min(a,b),c=Math.max(a,b),d=this.params.start,e=this.params.start+this.params.duration;if(f<=d&&c>=d)f=d,c=Math.min(c,e);else if(c>=e&&f<= e)f=Math.max(f,d),c=Math.min(c,e);else if(!(f>=d&&c<=e))return;return a<b?{from:f,to:c}:{from:c,to:f}}}}}function q(){var b=r(),a=b/(h-t);b!==k&&(this.Smoother.makeSmoothy(a),this.render(a));k=b}var c={},k=0,h=g()||0,t=Number(window.innerHeight)||window.innerHeight,n=[],p=[],r,m;r="pageYOffset"in window?function(){return(window.pageYOffset||0)-(document.clientTop||0)}:function(){return(document.scrollTop||0)-(document.clientTop||0)};m=window.jQuery?function(b,a,f){$(b).css(a,f)}:function(b,a,f){b.style.setProperty(a, f)};c.Queue=function(){this.endTime=0};c.Queue.prototype=Array.prototype.slice.call(Array.prototype);c.Queue.prototype.then=function(b,a){var f=u(b,a,this);"object"===typeof f&&this.push(f);return this};(function(b){var a=0;b.Smoother={smoothFrom:0,smoothTo:0,maxSpeed:.005,status:"idle",makeSmoothy:function(a){"idle"===this.status?this.run(a):this.smoothTo=a},run:function(a){this.status="playing";this.smoothTo=a;requestAnimationFrame(this.step.bind(this))},render:function(b){n.forEach(function(c){var d= c.length,e,g,h;for(e=0;e<d;e++)if(g=c[e],h=g.getIntersection(a,b)){g.render(b);break}});a=b},step:function(){var a=this.smoothTo-this.smoothFrom;Math.abs(a)>this.maxSpeed?(this.smoothFrom+=this.maxSpeed*(0>a?-1:1),this.render(this.smoothFrom),requestAnimationFrame(this.step.bind(this))):(this.render(this.smoothTo),this.smoothFrom=this.smoothTo,this.status="idle")}}})(c);c.add=function(b,a){var c;c=(new this.Queue).then(b,a);(a.maxSpeed?n:p).push(c);return c}.bind(c);c.render=function(b){p.forEach(function(a){a.forEach(function(a){a.render(b)})})}.bind(c); l(window,"resize",function(b){t=Number(window.innerHeight)||window.innerHeight;h=g();p.forEach(function(a){a.forEach(function(a){a.recalc(h)})});n.forEach(function(a){a.forEach(function(a){a.recalc(h)})})});l(window,"scroll",function(b){q.call(c);setTimeout(q.bind(c),100)});(d||function(){}).call(c);return c};
/**
 * Scrollissimo
 * Javascript plugin for scroll animation
 * @author frux
 */
(function(d){for(var k=0,g=["ms","moz","webkit","o"],h=0;h<g.length&&!d.requestAnimationFrame;++h)d.requestAnimationFrame=d[g[h]+"RequestAnimationFrame"],d.cancelAnimationFrame=d[g[h]+"CancelAnimationFrame"]||d[g[h]+"CancelRequestAnimationFrame"];d.requestAnimationFrame||(d.requestAnimationFrame=function(g,c){var h=(new Date).getTime(),l=Math.max(0,16-(h-k)),n=d.setTimeout(function(){g(h+l)},l);k=h+l;return n});d.cancelAnimationFrame||(d.cancelAnimationFrame=function(d){clearTimeout(d)})})(this); function Scrollissimo(d){function k(){var b=document.documentElement,a=document.body;return Math.max(a.scrollHeight,b.scrollHeight,a.offsetHeight,b.offsetHeight,a.clientHeight,b.clientHeight)}function g(b,a){a=a||l;if("string"===typeof b)return"%"===b.substr(-1,1)?parseInt(b)/100:"px"===b.substr(-2,2)?parseInt(b)/a:parseInt(b)/k();if(!isNaN(b))return b/a}function h(b,a,e){if("object"===typeof a){var f={};f.property=a.property;f.from=a.from||0;f.to=a.to||0;f.prefix=a.prefix||"";f.suffix=a.suffix|| "";f.duration=g(a.duration)||0;f.maxSpeed=parseFloat(a.maxSpeed);"undefined"===typeof(f.start=g(a.start))&&(f.start=e.endTime,e.endTime+=f.duration);f.queue=e;return{animator:null,sourceParams:a,params:f,render:function(a){a=(a-this.params.start)/this.params.duration;0<a&&1>a?m(b,this.params.property,this.params.prefix+(this.params.from+(this.params.to-this.params.from)*a)+this.params.suffix):1<=a?m(b,this.params.property,this.params.prefix+this.params.to+this.params.suffix):0>=a&&m(b,this.params.property, this.params.prefix+this.params.from+this.params.suffix)},recalc:function(a){var b={};a=a||k();b.from=this.sourceParams.from||0;b.to=this.sourceParams.to||0;b.prefix=this.sourceParams.prefix||"";b.suffix=this.sourceParams.suffix||"";b.duration=g(this.sourceParams.duration||"",a);"undefined"===typeof(b.start=g(this.sourceParams.start,a))&&(b.start=e.endTime,e.endTime+=b.duration);this.params=b},getIntersection:function(a,b){var e=Math.min(a,b),f=Math.max(a,b),d=this.params.start,c=this.params.start+ this.params.duration;if(e<=d&&f>=d)e=d,f=Math.min(f,c);else if(f>=c&&e<=c)e=Math.max(e,d),f=Math.min(f,c);else if(!(e>=d&&f<=c))return;return a<b?{from:e,to:f}:{from:f,to:e}}}}}function p(){var b=r(),a=b/(l-n);b!==q&&(this.Smoother(a),this.render(a));q=b;requestAnimationFrame(p.bind(this))}var c={},q=0,l=k()||0,n=Number(window.innerHeight)||window.innerHeight,t=[],u=[],r,m;r="pageYOffset"in window?function(){return(window.pageYOffset||0)-(document.clientTop||0)}:function(){return(document.scrollTop|| 0)-(document.clientTop||0)};m=window.jQuery?function(b,a,e){$(b).css(a,e)}:function(b,a,e){b.style.setProperty(a,e)};c.Queue=function(){this.endTime=0};c.Queue.prototype=Array.prototype.slice.call(Array.prototype);c.Queue.prototype.then=function(b,a){var e=h(b,a,this);"object"===typeof e&&this.push(e);return this};(function(b){var a=0;b.Smoother=function(a){b.Smoother.smooth(a)};b.Smoother.Animator=function(a){this.status="stopped";this.animateTo=this.animateFrom=0;this.tween=a};b.Smoother.Animator.prototype.step= function(){var a=this.animateTo-this.animateFrom,b=Math.abs(a),d=this.tween.params.maxSpeed;b>d&&(a=0<a?d:-d,b=Math.abs(a));this.animateFrom+=a;this.tween.render.call(this.tween,this.animateFrom);0<b?requestAnimationFrame(this.step.bind(this)):this.status="stopped"};b.Smoother.Animator.prototype.run=function(){this.status="playing";this.id&&cancelAnimationFrame(this.id);this.id=requestAnimationFrame(this.step.bind(this));return this};b.Smoother.smooth=function(b){var d=this;t.forEach(function(c){c.forEach(function(c){var g= c.getIntersection.call(c,a,b);g&&g.from!==g.to&&(!c.animator&&(c.animator=new d.Animator(c))||"playing"!==c.animator.status?(c.animator.animateTo=g.to,c.animator.run()):c.animator.animateTo=g.to)})});a=b}.bind(b.Smoother)})(c);c.add=function(b,a){var c;c=(new this.Queue).then(b,a);(a.maxSpeed?t:u).push(c);return c}.bind(c);c.render=function(b){u.forEach(function(a){a.forEach(function(a){a.render(b)})})}.bind(c);window.addEventListener("scroll",function(){}.bind(c));requestAnimationFrame(p.bind(c)); (d||function(){}).call(c);return c};